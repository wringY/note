# Hook
- Hook æ˜¯ä»€ä¹ˆï¼Ÿ Hook æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼Œ**å®ƒå¯ä»¥è®©ä½ â€œé’©å…¥â€ React çš„ç‰¹æ€§**ã€‚ä¾‹å¦‚ï¼ŒuseState æ˜¯å…è®¸ä½ åœ¨ React å‡½æ•°ç»„ä»¶ä¸­æ·»åŠ  state çš„ Hookã€‚
- Hook åœ¨ class å†…éƒ¨æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚ä½†ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥å–ä»£ class ã€‚
~~~js
const Example = (props) => {
  // ä½ å¯ä»¥åœ¨è¿™ä½¿ç”¨ Hook
  return <div />;
}
~~~
- ä¹‹å‰å¯èƒ½æŠŠå®ƒä»¬å«åšâ€œæ— çŠ¶æ€ç»„ä»¶â€ã€‚ä½†ç°åœ¨æˆ‘ä»¬ä¸ºå®ƒä»¬å¼•å…¥äº†ä½¿ç”¨ React state çš„èƒ½åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´å–œæ¬¢å«å®ƒâ€å‡½æ•°ç»„ä»¶â€ã€‚
- ä»€ä¹ˆæ—¶å€™æˆ‘ä¼šç”¨ Hookï¼Ÿ å¦‚æœä½ åœ¨ç¼–å†™å‡½æ•°ç»„ä»¶å¹¶æ„è¯†åˆ°éœ€è¦å‘å…¶æ·»åŠ ä¸€äº› stateï¼Œä»¥å‰çš„åšæ³•æ˜¯å¿…é¡»å°†å…¶å®ƒè½¬åŒ–ä¸º classã€‚ç°åœ¨ä½ å¯ä»¥åœ¨ç°æœ‰çš„å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ Hookã€‚
>æ³¨æ„ï¼š
åœ¨ç»„ä»¶ä¸­æœ‰äº›ç‰¹æ®Šçš„è§„åˆ™ï¼Œè§„å®šä»€ä¹ˆåœ°æ–¹èƒ½ä½¿ç”¨ Hookï¼Œä»€ä¹ˆåœ°æ–¹ä¸èƒ½ä½¿ç”¨ã€‚æˆ‘ä»¬å°†åœ¨ Hook è§„åˆ™ä¸­å­¦ä¹ å®ƒä»¬ã€‚
>
## ä¸ºä»€ä¹ˆä½¿ç”¨Hook

### ç»„ä»¶å¤ç”¨å›°å±€

- ç»„ä»¶å¹¶ä¸æ˜¯å•çº¯çš„ä¿¡æ¯å­¤å²›ï¼Œç»„ä»¶ä¹‹é—´æ˜¯å¯èƒ½ä¼šäº§ç”Ÿè”ç³»çš„ï¼Œä¸€æ–¹é¢æ˜¯æ•°æ®çš„å…±äº«ï¼Œå¦ä¸€ä¸ªæ˜¯åŠŸèƒ½çš„å¤ç”¨ï¼š

1. å¯¹äºç»„ä»¶ä¹‹é—´çš„æ•°æ®å…±äº«é—®é¢˜ï¼ŒReactå®˜æ–¹é‡‡ç”¨å•å‘æ•°æ®æµï¼ˆFluxï¼‰æ¥è§£å†³

   å¯¹äºï¼ˆæœ‰çŠ¶æ€ï¼‰ç»„ä»¶çš„å¤ç”¨ï¼ŒReactå›¢é˜Ÿç»™å‡ºè¿‡è®¸å¤šçš„æ–¹æ¡ˆï¼Œæ—©æœŸä½¿ç”¨CreateClass + Mixinsï¼Œåœ¨ä½¿ç”¨Class Componentå–ä»£CreateClassä¹‹ååˆè®¾è®¡äº†`Render Props`å’Œ`Higher Order Component`ï¼Œç›´åˆ°å†åæ¥çš„Function Component+ Hooksè®¾è®¡ï¼ŒReactå›¢é˜Ÿå¯¹äºç»„ä»¶å¤ç”¨çš„æ¢ç´¢ä¸€ç›´æ²¡æœ‰åœæ­¢
- HOCä½¿ç”¨ï¼ˆè€ç”Ÿå¸¸è°ˆï¼‰çš„é—®é¢˜ï¼š
  >
    åµŒå¥—åœ°ç‹±ï¼Œæ¯ä¸€æ¬¡HOCè°ƒç”¨éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªç»„ä»¶å®ä¾‹
    å¯ä»¥ä½¿ç”¨ç±»è£…é¥°å™¨ç¼“è§£ç»„ä»¶åµŒå¥—å¸¦æ¥çš„å¯ç»´æŠ¤æ€§é—®é¢˜ï¼Œä½†è£…é¥°å™¨æœ¬è´¨ä¸Šè¿˜æ˜¯HOC
    åŒ…è£¹å¤ªå¤šå±‚çº§ä¹‹åï¼Œå¯èƒ½ä¼šå¸¦æ¥propså±æ€§çš„è¦†ç›–é—®é¢˜
  >
- Render Propsï¼š
  >
  æ•°æ®æµå‘æ›´ç›´è§‚äº†ï¼Œå­å­™ç»„ä»¶å¯ä»¥å¾ˆæ˜ç¡®åœ°çœ‹åˆ°æ•°æ®æ¥æº
  ä½†æœ¬è´¨ä¸ŠRender Propsæ˜¯åŸºäºé—­åŒ…å®ç°çš„ï¼Œå¤§é‡åœ°ç”¨äºç»„ä»¶çš„å¤ç”¨å°†ä¸å¯é¿å…åœ°å¼•å…¥äº†callback hellé—®é¢˜
  ä¸¢å¤±äº†ç»„ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œå› æ­¤æ²¡æœ‰this.propså±æ€§ï¼Œä¸èƒ½åƒHOCé‚£æ ·è®¿é—®this.props.children
  >
1. react-hookså¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç çš„é€»è¾‘æ€§æ›´å¼ºï¼Œå¯ä»¥æŠ½ç¦»å…¬å…±çš„æ–¹æ³•ï¼Œå…¬å…±ç»„ä»¶ã€‚
2. react-hooksæ€æƒ³æ›´è¶‹è¿‘äºå‡½æ•°å¼ç¼–ç¨‹ã€‚ç”¨å‡½æ•°å£°æ˜æ–¹å¼ä»£æ›¿classå£°æ˜æ–¹å¼ï¼Œè™½è¯´classä¹Ÿæ˜¯es6æ„é€ å‡½æ•°è¯­æ³•ç³–ï¼Œä½†æ˜¯react-hookså†™èµ·æ¥æ›´æœ‰å‡½æ•°å³ç»„ä»¶ï¼Œæ— ç–‘ä¹Ÿæé«˜ä»£ç çš„å¼€å‘æ•ˆç‡ï¼ˆæ— éœ€åƒclasså£°æ˜ç»„ä»¶é‚£æ ·å†™å£°æ˜å‘¨æœŸï¼Œå†™ç”Ÿå‘½å‘¨æœŸrenderå‡½æ•°ç­‰ï¼‰
3. react-hookså¯èƒ½æŠŠåºå¤§çš„classç»„ä»¶ï¼ŒåŒ–æ•´ä¸ºé›¶æˆå¾ˆå¤šå°ç»„ä»¶ï¼ŒuseMemoç­‰æ–¹æ³•è®©ç»„ä»¶æˆ–è€…å˜é‡åˆ¶å®šä¸€ä¸ªé€‚åˆè‡ªå·±çš„ç‹¬ç«‹çš„æ¸²æŸ“ç©ºé—´ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æé«˜æ€§èƒ½ï¼Œå‡å°‘æ¸²æŸ“æ¬¡æ•°ã€‚è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœæŠŠè´Ÿè´£ è¯·æ±‚æ˜¯æ•°æ® â¡ï¸  è§†å›¾æ›´æ–°çš„æ¸²æŸ“ç»„ä»¶ï¼Œç”¨react-hooksç¼–å†™çš„è¯ ï¼Œé…åˆimmutableç­‰ä¼˜ç§€çš„å¼€æºåº“ï¼Œä¼šæœ‰æ›´æ£’çš„æ•ˆæœ(è¿™é‡Œç‰¹åˆ«æ³¨æ„çš„æ˜¯âš ï¸ï¼Œå¦‚æœä¹±ç”¨hooksï¼Œä¸ä½†ä¸ä¼šæå‡æ€§èƒ½ï¼Œåè€Œä¼šå½±å“æ€§èƒ½ï¼Œå¸¦æ¥å„ç§å„æ ·çš„æƒ³ä¸åˆ°çš„é—®é¢˜)ã€‚
## Hookä½¿ç”¨è§„åˆ™
- Hook å°±æ˜¯ JavaScript å‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒä»¬ä¼šæœ‰ä¸¤ä¸ªé¢å¤–çš„è§„åˆ™ï¼š
1. åªèƒ½åœ¨å‡½æ•°æœ€å¤–å±‚è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…å­å‡½æ•°ä¸­è°ƒç”¨ã€‚ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookï¼Œ ç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„ React å‡½æ•°çš„æœ€é¡¶å±‚ä»¥åŠä»»ä½• return ä¹‹å‰è°ƒç”¨ä»–ä»¬ã€‚éµå®ˆè¿™æ¡è§„åˆ™ï¼Œä½ å°±èƒ½ç¡®ä¿ Hook åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½æŒ‰ç…§åŒæ ·çš„é¡ºåºè¢«è°ƒç”¨ã€‚è¿™è®© React èƒ½å¤Ÿåœ¨å¤šæ¬¡çš„ useState å’Œ useEffect è°ƒç”¨ä¹‹é—´ä¿æŒ hook çŠ¶æ€çš„æ­£ç¡®ã€‚
2. åªèƒ½åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å…¶ä»– JavaScript å‡½æ•°ä¸­è°ƒç”¨ã€‚ï¼ˆè¿˜æœ‰ä¸€ä¸ªåœ°æ–¹å¯ä»¥è°ƒç”¨ Hook â€”â€” å°±æ˜¯è‡ªå®šä¹‰çš„ Hook ä¸­ï¼Œæˆ‘ä»¬ç¨åä¼šå­¦ä¹ åˆ°ã€‚ï¼‰
### è§„åˆ™è¯´æ˜
- æˆ‘ä»¬å¯ä»¥åœ¨å•ä¸ªç»„ä»¶ä¸­ä½¿ç”¨å¤šä¸ª State Hook æˆ– Effect Hook
~~~js
function Form() {
  // 1. Use the name state variable
  const [name, setName] = useState('Mary');

  // 2. Use an effect for persisting the form
  useEffect(function persistForm() {
    localStorage.setItem('formData', name);
  });

  // 3. Use the surname state variable
  const [surname, setSurname] = useState('Poppins');

  // 4. Use an effect for updating the title
  useEffect(function updateTitle() {
    document.title = name + ' ' + surname;
  });

  // ...
}
~~~
- é‚£ä¹ˆ React æ€ä¹ˆçŸ¥é“å“ªä¸ª state å¯¹åº”å“ªä¸ª useStateï¼Ÿç­”æ¡ˆæ˜¯ React é çš„æ˜¯ Hook è°ƒç”¨çš„é¡ºåºã€‚å› ä¸ºæˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼ŒHook çš„è°ƒç”¨é¡ºåºåœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼š
~~~js
// ------------
// é¦–æ¬¡æ¸²æŸ“
// ------------
useState('Mary')           // 1. ä½¿ç”¨ 'Mary' åˆå§‹åŒ–å˜é‡åä¸º name çš„ state
useEffect(persistForm)     // 2. æ·»åŠ  effect ä»¥ä¿å­˜ form æ“ä½œ
useState('Poppins')        // 3. ä½¿ç”¨ 'Poppins' åˆå§‹åŒ–å˜é‡åä¸º surname çš„ state
useEffect(updateTitle)     // 4. æ·»åŠ  effect ä»¥æ›´æ–°æ ‡é¢˜

// -------------
// äºŒæ¬¡æ¸²æŸ“
// -------------
useState('Mary')           // 1. è¯»å–å˜é‡åä¸º name çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰
useEffect(persistForm)     // 2. æ›¿æ¢ä¿å­˜ form çš„ effect
useState('Poppins')        // 3. è¯»å–å˜é‡åä¸º surname çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰
useEffect(updateTitle)     // 4. æ›¿æ¢æ›´æ–°æ ‡é¢˜çš„ effect

// ...
~~~
- åªè¦ Hook çš„è°ƒç”¨é¡ºåºåœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ä¿æŒä¸€è‡´ï¼ŒReact å°±èƒ½æ­£ç¡®åœ°å°†å†…éƒ¨ state å’Œå¯¹åº”çš„ Hook è¿›è¡Œå…³è”ã€‚ä½†å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ª Hook (ä¾‹å¦‚ persistForm effect) è°ƒç”¨æ”¾åˆ°ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢
~~~js
 // ğŸ”´ åœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ Hook è¿åç¬¬ä¸€æ¡è§„åˆ™
  if (name !== '') {
    useEffect(function persistForm() {
      localStorage.setItem('formData', name);
    });
  }
~~~
- åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ name !== '' è¿™ä¸ªæ¡ä»¶å€¼ä¸º trueï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šæ‰§è¡Œè¿™ä¸ª Hookã€‚ä½†æ˜¯ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶æˆ‘ä»¬å¯èƒ½æ¸…ç©ºäº†è¡¨å•ï¼Œè¡¨è¾¾å¼å€¼å˜ä¸º falseã€‚æ­¤æ—¶çš„æ¸²æŸ“ä¼šè·³è¿‡è¯¥ Hookï¼ŒHook çš„è°ƒç”¨é¡ºåºå‘ç”Ÿäº†æ”¹å˜ï¼š
~~~js
useState('Mary')           // 1. è¯»å–å˜é‡åä¸º name çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰
// useEffect(persistForm)  // ğŸ”´ æ­¤ Hook è¢«å¿½ç•¥ï¼
useState('Poppins')        // ğŸ”´ 2 ï¼ˆä¹‹å‰ä¸º 3ï¼‰ã€‚è¯»å–å˜é‡åä¸º surname çš„ state å¤±è´¥
useEffect(updateTitle)     // ğŸ”´ 3 ï¼ˆä¹‹å‰ä¸º 4ï¼‰ã€‚æ›¿æ¢æ›´æ–°æ ‡é¢˜çš„ effect å¤±è´¥
~~~
- React ä¸çŸ¥é“ç¬¬äºŒä¸ª useState çš„ Hook åº”è¯¥è¿”å›ä»€ä¹ˆã€‚React ä¼šä»¥ä¸ºåœ¨è¯¥ç»„ä»¶ä¸­ç¬¬äºŒä¸ª Hook çš„è°ƒç”¨åƒä¸Šæ¬¡çš„æ¸²æŸ“ä¸€æ ·ï¼Œå¯¹åº”çš„æ˜¯ persistForm çš„ effectï¼Œä½†å¹¶éå¦‚æ­¤ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œåé¢çš„ Hook è°ƒç”¨éƒ½è¢«æå‰æ‰§è¡Œï¼Œå¯¼è‡´ bug çš„äº§ç”Ÿã€‚
- è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Hook éœ€è¦åœ¨æˆ‘ä»¬ç»„ä»¶çš„æœ€é¡¶å±‚è°ƒç”¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æœ‰æ¡ä»¶åœ°æ‰§è¡Œä¸€ä¸ª effectï¼Œå¯ä»¥å°†åˆ¤æ–­æ”¾åˆ° Hook çš„å†…éƒ¨ï¼š
~~~js
 useEffect(function persistForm() {
    // ğŸ‘ å°†æ¡ä»¶åˆ¤æ–­æ”¾ç½®åœ¨ effect ä¸­
    if (name !== '') {
      localStorage.setItem('formData', name);
    }
  });
~~~
## ä½¿ç”¨ State Hook
### å£°æ˜ State å˜é‡
- useStateå‡ºç°ï¼Œä½¿å¾—reactæ— çŠ¶æ€ç»„ä»¶èƒ½å¤Ÿåƒæœ‰çŠ¶æ€ç»„ä»¶ä¸€æ ·ï¼Œå¯ä»¥æ‹¥æœ‰è‡ªå·±state,useStateçš„å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ç”¨äºåˆ¤æ–­å¤æ‚çš„é€»è¾‘ï¼Œå‡½æ•°è¿”å›ä½œä¸ºåˆå§‹å€¼ï¼Œusestate è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ç¬¬ä¸€é¡¹ç”¨äºè¯»å–æ­¤æ—¶çš„stateå€¼ ï¼Œç¬¬äºŒé¡¹ä¸ºæ´¾å‘æ•°æ®æ›´æ–°ï¼Œç»„ä»¶æ¸²æŸ“çš„å‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°å³æ˜¯éœ€è¦æ›´æ–°çš„å€¼ã€‚useStateå’ŒuseReduce ä½œä¸ºèƒ½å¤Ÿè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“çš„hooks,**æˆ‘ä»¬åœ¨ä½¿ç”¨useStateçš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼ŒuseStateæ´¾å‘æ›´æ–°å‡½æ•°çš„æ‰§è¡Œï¼Œå°±ä¼šè®©æ•´ä¸ªfunctionç»„ä»¶ä»å¤´åˆ°å°¾æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥éœ€è¦é…åˆuseMemoï¼Œusecallbackç­‰apié…åˆä½¿ç”¨ï¼Œè¿™å°±æ˜¯æˆ‘è¯´çš„ä¸ºä»€ä¹ˆæ»¥ç”¨hooksä¼šå¸¦æ¥è´Ÿä½œç”¨çš„åŸå› ä¹‹ä¸€äº†**ã€‚
åœ¨ class ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½® this.state ä¸º { count: 0 } æ¥åˆå§‹åŒ– count state ä¸º 0ï¼š
~~~js
class Example extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
  }
~~~
- åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ thisï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åˆ†é…æˆ–è¯»å– this.stateã€‚æˆ‘ä»¬ç›´æ¥åœ¨ç»„ä»¶ä¸­è°ƒç”¨ useState Hookï¼š
~~~js
import React, { useState } from 'react';

function Example() {
  // å£°æ˜ä¸€ä¸ªå« â€œcountâ€ çš„ state å˜é‡
  const [count, setCount] = useState(0);
~~~
- è°ƒç”¨ useState æ–¹æ³•çš„æ—¶å€™åšäº†ä»€ä¹ˆ? å®ƒå®šä¹‰ä¸€ä¸ª â€œstate å˜é‡â€ã€‚æˆ‘ä»¬çš„å˜é‡å« countï¼Œ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å«ä»–ä»»ä½•åå­—ï¼Œæ¯”å¦‚ bananaã€‚è¿™æ˜¯ä¸€ç§åœ¨å‡½æ•°è°ƒç”¨æ—¶ä¿å­˜å˜é‡çš„æ–¹å¼ â€”â€” useState æ˜¯ä¸€ç§æ–°æ–¹æ³•ï¼Œå®ƒä¸ class é‡Œé¢çš„ this.state æä¾›çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å‡½æ•°é€€å‡ºåå˜é‡å°±ä¼šâ€æ¶ˆå¤±â€ï¼Œè€Œ state ä¸­çš„å˜é‡ä¼šè¢« React ä¿ç•™ã€‚
- useState éœ€è¦å“ªäº›å‚æ•°ï¼Ÿ useState() æ–¹æ³•é‡Œé¢å”¯ä¸€çš„å‚æ•°å°±æ˜¯åˆå§‹ stateã€‚ä¸åŒäº class çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§éœ€è¦ä½¿ç”¨æ•°å­—æˆ–å­—ç¬¦ä¸²å¯¹å…¶è¿›è¡Œèµ‹å€¼ï¼Œè€Œä¸ä¸€å®šæ˜¯å¯¹è±¡ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œåªéœ€ä½¿ç”¨æ•°å­—æ¥è®°å½•ç”¨æˆ·ç‚¹å‡»æ¬¡æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ äº† 0 ä½œä¸ºå˜é‡çš„åˆå§‹ stateã€‚ï¼ˆå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ state ä¸­å­˜å‚¨ä¸¤ä¸ªä¸åŒçš„å˜é‡ï¼Œåªéœ€è°ƒç”¨ useState() ä¸¤æ¬¡å³å¯ã€‚ï¼‰
- useState æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Ÿ è¿”å›å€¼ä¸ºï¼šå½“å‰ state ä»¥åŠæ›´æ–° state çš„å‡½æ•°ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å†™ const [count, setCount] = useState() çš„åŸå› ã€‚è¿™ä¸ class é‡Œé¢ this.state.count å’Œ this.setState ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯ä½ éœ€è¦æˆå¯¹çš„è·å–å®ƒä»¬ã€‚
>æ³¨æ„
ä½ å¯èƒ½æƒ³çŸ¥é“ï¼šä¸ºä»€ä¹ˆå« useState è€Œä¸å« createState?
â€œCreateâ€ å¯èƒ½ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œå› ä¸º state åªåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™è¢«åˆ›å»ºã€‚åœ¨ä¸‹ä¸€æ¬¡é‡æ–°æ¸²æŸ“æ—¶ï¼ŒuseState è¿”å›ç»™æˆ‘ä»¬å½“å‰çš„ stateã€‚å¦åˆ™å®ƒå°±ä¸æ˜¯ â€œstateâ€äº†ï¼è¿™ä¹Ÿæ˜¯ Hook çš„åå­—æ€»æ˜¯ä»¥ use å¼€å¤´çš„ä¸€ä¸ªåŸå› ã€‚æˆ‘ä»¬å°†åœ¨åé¢çš„ Hook è§„åˆ™ä¸­äº†è§£åŸå› ã€‚
~~~js
const DemoState = (props) => {
   /* numberä¸ºæ­¤æ—¶stateè¯»å–å€¼ ï¼ŒsetNumberä¸ºæ´¾å‘æ›´æ–°çš„å‡½æ•° */
   let [number, setNumber] = useState(0) /* 0ä¸ºåˆå§‹å€¼ */
   return (<div>
       <span>{ number }</span>
       <button onClick={ ()=> {
         setNumber(number+1) /* å†™æ³•ä¸€ */
         setNumber(number=>number + 1 ) /* å†™æ³•äºŒ */
         console.log(number) /* è¿™é‡Œçš„numberæ˜¯ä¸èƒ½å¤Ÿå³æ—¶æ”¹å˜çš„  */
       } } >num++</button>
   </div>)
}
~~~
- ä¸åƒ class ä¸­çš„ this.setStateï¼Œ**æ›´æ–° state å˜é‡æ€»æ˜¯æ›¿æ¢å®ƒè€Œä¸æ˜¯åˆå¹¶å®ƒ**ã€‚
## Effect Hook
- å¦‚æœä½ æƒ³åœ¨functionç»„ä»¶ä¸­ï¼Œå½“ç»„ä»¶å®ŒæˆæŒ‚è½½ï¼Œdomæ¸²æŸ“å®Œæˆï¼Œåšä¸€äº›æ“çºµdom,è¯·æ±‚æ•°æ®ï¼Œé‚£ä¹ˆuseEffectæ˜¯ä¸€ä¸ªä¸äºŒé€‰æ‹©ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶åˆæ¬¡æ¸²æŸ“çš„æ—¶å€™è¯·æ±‚æ•°æ®ï¼Œé‚£ä¹ˆuseEffectå¯ä»¥å……å½“classç»„ä»¶ä¸­çš„ componentDidMount , **ä½†æ˜¯ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸ç»™useEffectæ‰§è¡ŒåŠ å…¥é™å®šæ¡ä»¶ï¼Œå‡½æ•°ç»„ä»¶æ¯ä¸€æ¬¡æ›´æ–°éƒ½ä¼šè§¦å‘effect ,é‚£ä¹ˆä¹Ÿå°±è¯´æ˜æ¯ä¸€æ¬¡stateæ›´æ–°ï¼Œæˆ–æ˜¯propsçš„æ›´æ–°éƒ½ä¼šè§¦å‘useEffectæ‰§è¡Œï¼Œæ­¤æ—¶çš„effectåˆå……å½“äº†componentDidUpdateå’Œcomponentwillreceivepropsï¼Œæ‰€ä»¥è¯´åˆç†çš„ç”¨äºuseEffectå°±è¦ç»™effectåŠ å…¥é™å®šæ‰§è¡Œçš„æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯useEffectçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™é‡Œè¯´æ˜¯é™å®šæ¡ä»¶ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸Šä¸€æ¬¡useeffectæ›´æ–°æ”¶é›†çš„æŸäº›è®°å½•æ•°æ®å˜åŒ–çš„è®°å¿†ï¼Œåœ¨æ–°çš„ä¸€è½®æ›´æ–°ï¼Œuseeffectä¼šæ‹¿å‡ºä¹‹å‰çš„è®°å¿†å€¼å’Œå½“å‰å€¼åšå¯¹æ¯”ï¼Œå¦‚æœå‘ç”Ÿäº†å˜åŒ–å°±æ‰§è¡Œæ–°çš„ä¸€è½®useEffectçš„å‰¯ä½œç”¨å‡½æ•°ï¼ŒuseEffectç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥æ”¶é›†å¤šä¸ªé™åˆ¶æ¡ä»¶** ã€‚
- å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶é”€æ¯çš„é˜¶æ®µï¼Œåšä¸€äº›å–æ¶ˆdomç›‘å¬ï¼Œæ¸…é™¤å®šæ—¶å™¨ç­‰æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨useEffectå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç»“å°¾è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ¸…é™¤è¿™äº›å‰¯ä½œç”¨ã€‚ç›¸å½“ä¸componentWillUnmountã€‚
- ä½ ä¹‹å‰å¯èƒ½å·²ç»åœ¨ React ç»„ä»¶ä¸­æ‰§è¡Œè¿‡æ•°æ®è·å–ã€è®¢é˜…æˆ–è€…æ‰‹åŠ¨ä¿®æ”¹è¿‡ DOMã€‚æˆ‘ä»¬ç»Ÿä¸€æŠŠè¿™äº›æ“ä½œç§°ä¸ºâ€œå‰¯ä½œç”¨â€ï¼Œæˆ–è€…ç®€ç§°ä¸ºâ€œä½œç”¨â€ã€‚
- useEffect å°±æ˜¯ä¸€ä¸ª Effect Hookï¼Œç»™å‡½æ•°ç»„ä»¶å¢åŠ äº†æ“ä½œå‰¯ä½œç”¨çš„èƒ½åŠ›ã€‚å®ƒè·Ÿ class ç»„ä»¶ä¸­çš„ componentDidMountã€componentDidUpdate å’Œ componentWillUnmount å…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œåªä¸è¿‡è¢«åˆå¹¶æˆäº†ä¸€ä¸ª APIã€‚ï¼ˆæˆ‘ä»¬ä¼šåœ¨ä½¿ç”¨ Effect Hook é‡Œå±•ç¤ºå¯¹æ¯” useEffect å’Œè¿™äº›æ–¹æ³•çš„ä¾‹å­ã€‚ï¼‰
~~~js
import React, { useState, useEffect } from 'react';

function Example() {
  const [count, setCount] = useState(0);

  // ç›¸å½“äº componentDidMount å’Œ componentDidUpdate:
  useEffect(() => {
    // ä½¿ç”¨æµè§ˆå™¨çš„ API æ›´æ–°é¡µé¢æ ‡é¢˜
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
~~~
- å½“ä½ è°ƒç”¨ useEffect æ—¶ï¼Œå°±æ˜¯åœ¨å‘Šè¯‰ React åœ¨å®Œæˆå¯¹ DOM çš„æ›´æ”¹åè¿è¡Œä½ çš„â€œå‰¯ä½œç”¨â€å‡½æ•°ã€‚ç”±äºå‰¯ä½œç”¨å‡½æ•°æ˜¯åœ¨ç»„ä»¶å†…å£°æ˜çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥è®¿é—®åˆ°ç»„ä»¶çš„ props å’Œ stateã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè°ƒç”¨å‰¯ä½œç”¨å‡½æ•° â€”â€” åŒ…æ‹¬ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ã€‚ï¼ˆæˆ‘ä»¬ä¼šåœ¨ä½¿ç”¨ Effect Hook ä¸­è·Ÿ class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åšæ›´è¯¦ç»†çš„å¯¹æ¯”ã€‚ï¼‰
- useEffectå¯ä»¥å¼¥è¡¥å‡½æ•°ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç¼ºç‚¹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨useEffectç¬¬ä¸€ä¸ªå‚æ•°å›è°ƒå‡½æ•°ä¸­ï¼Œåšä¸€äº›è¯·æ±‚æ•°æ®ï¼Œäº‹ä»¶ç›‘å¬ç­‰æ“ä½œï¼Œç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºdepä¾èµ–é¡¹ï¼Œå½“ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–ï¼Œé‡æ–°æ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°ã€‚
### useEffectå¯ä»¥ç”¨ä½œæ•°æ®äº¤äº’
~~~js
/* æ¨¡æ‹Ÿæ•°æ®äº¤äº’ */
function getUserInfo(a){
    return new Promise((resolve)=>{
        setTimeout(()=>{ 
           resolve({
               name:a,
               age:16,
           }) 
        },500)
    })
}
const DemoEffect = ({ a }) => {
    const [ userMessage , setUserMessage ] :any= useState({})
    const div= useRef()
    const [number, setNumber] = useState(0)
    /* æ¨¡æ‹Ÿäº‹ä»¶ç›‘å¬å¤„ç†å‡½æ•° */
    const handleResize =()=>{}
    /* useEffectä½¿ç”¨ ï¼Œè¿™é‡Œå¦‚æœä¸åŠ é™åˆ¶ ï¼Œä¼šæ˜¯å‡½æ•°é‡å¤æ‰§è¡Œï¼Œé™·å…¥æ­»å¾ªç¯*/
    useEffect(()=>{
        /* è¯·æ±‚æ•°æ® */
       getUserInfo(a).then(res=>{
           setUserMessage(res)
       })
       /* æ“ä½œdom  */
       console.log(div.current) /* div */
       /* äº‹ä»¶ç›‘å¬ç­‰ */
        window.addEventListener('resize', handleResize)
    /* åªæœ‰å½“props->aå’Œstate->numberæ”¹å˜çš„æ—¶å€™ ,useEffectå‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œ ï¼Œå¦‚æœæ­¤æ—¶æ•°ç»„ä¸ºç©º[]ï¼Œè¯æ˜å‡½æ•°åªæœ‰åœ¨åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ç›¸å½“äºcomponentDidMount */
    },[ a ,number ])
    return (<div ref={div} >
        <span>{ userMessage.name }</span>
        <span>{ userMessage.age }</span>
        <div onClick={ ()=> setNumber(1) } >{ number }</div>
    </div>)
}
~~~
### useEffectå¯ä»¥ç”¨ä½œäº‹ä»¶ç›‘å¬ï¼Œè¿˜æœ‰ä¸€äº›åŸºäºdomçš„æ“ä½œã€‚
- useEffectå¯ä»¥ç”¨ä½œäº‹ä»¶ç›‘å¬ï¼Œè¿˜æœ‰ä¸€äº›åŸºäºdomçš„æ“ä½œã€‚,åˆ«å¿˜äº†åœ¨useEffectç¬¬ä¸€ä¸ªå‚æ•°å›è°ƒå‡½æ•°ï¼Œè¿”ä¸€ä¸ªå‡½æ•°ç”¨äºæ¸…é™¤äº‹ä»¶ç›‘å¬ç­‰æ“ä½œã€‚
~~~js
const DemoEffect = ({ a }) => {
    /* æ¨¡æ‹Ÿäº‹ä»¶ç›‘å¬å¤„ç†å‡½æ•° */
    const handleResize =()=>{}
    useEffect(()=>{
       /* å®šæ—¶å™¨ å»¶æ—¶å™¨ç­‰ */
       const timer = setInterval(()=>console.log(666),1000)
       /* äº‹ä»¶ç›‘å¬ */
       window.addEventListener('resize', handleResize)
       /* æ­¤å‡½æ•°ç”¨äºæ¸…é™¤å‰¯ä½œç”¨ */
       return function(){
           clearInterval(timer) 
           window.removeEventListener('resize', handleResize)
       }
    },[ a ])
    return (<div  >
    </div>)
}
~~~
- useEffect åšäº†ä»€ä¹ˆï¼Ÿ é€šè¿‡ä½¿ç”¨è¿™ä¸ª Hookï¼Œä½ å¯ä»¥å‘Šè¯‰ React ç»„ä»¶éœ€è¦åœ¨æ¸²æŸ“åæ‰§è¡ŒæŸäº›æ“ä½œã€‚React ä¼šä¿å­˜ä½ ä¼ é€’çš„å‡½æ•°ï¼ˆæˆ‘ä»¬å°†å®ƒç§°ä¹‹ä¸º â€œeffectâ€ï¼‰ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œ DOM æ›´æ–°ä¹‹åè°ƒç”¨å®ƒã€‚åœ¨è¿™ä¸ª effect ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº† document çš„ title å±æ€§ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰§è¡Œæ•°æ®è·å–æˆ–è°ƒç”¨å…¶ä»–å‘½ä»¤å¼çš„ APIã€‚
- ä¸ºä»€ä¹ˆåœ¨ç»„ä»¶å†…éƒ¨è°ƒç”¨ useEffectï¼Ÿ å°† useEffect æ”¾åœ¨ç»„ä»¶å†…éƒ¨è®©æˆ‘ä»¬å¯ä»¥åœ¨ effect ä¸­ç›´æ¥è®¿é—® count state å˜é‡ï¼ˆæˆ–å…¶ä»– propsï¼‰ã€‚æˆ‘ä»¬ä¸éœ€è¦ç‰¹æ®Šçš„ API æ¥è¯»å–å®ƒ â€”â€” å®ƒå·²ç»ä¿å­˜åœ¨å‡½æ•°ä½œç”¨åŸŸä¸­ã€‚Hook ä½¿ç”¨äº† JavaScript çš„é—­åŒ…æœºåˆ¶ï¼Œè€Œä¸ç”¨åœ¨ JavaScript å·²ç»æä¾›äº†è§£å†³æ–¹æ¡ˆçš„æƒ…å†µä¸‹ï¼Œè¿˜å¼•å…¥ç‰¹å®šçš„ React APIã€‚
- useEffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œå—ï¼Ÿ æ˜¯çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚ï¼ˆæˆ‘ä»¬ç¨åä¼šè°ˆåˆ°å¦‚ä½•æ§åˆ¶å®ƒã€‚ï¼‰ä½ å¯èƒ½ä¼šæ›´å®¹æ˜“æ¥å— effect å‘ç”Ÿåœ¨â€œæ¸²æŸ“ä¹‹åâ€è¿™ç§æ¦‚å¿µï¼Œä¸ç”¨å†å»è€ƒè™‘â€œæŒ‚è½½â€è¿˜æ˜¯â€œæ›´æ–°â€ã€‚**React ä¿è¯äº†æ¯æ¬¡è¿è¡Œ effect çš„åŒæ—¶ï¼ŒDOM éƒ½å·²ç»æ›´æ–°å®Œæ¯•**ã€‚

- ä¸ºä»€ä¹ˆè¦åœ¨ effect ä¸­è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Ÿ è¿™æ˜¯ effect å¯é€‰çš„æ¸…é™¤æœºåˆ¶ã€‚æ¯ä¸ª effect éƒ½å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ã€‚å¦‚æ­¤å¯ä»¥å°†æ·»åŠ å’Œç§»é™¤è®¢é˜…çš„é€»è¾‘æ”¾åœ¨ä¸€èµ·ã€‚å®ƒä»¬éƒ½å±äº effect çš„ä¸€éƒ¨åˆ†ã€‚
- React ä½•æ—¶æ¸…é™¤ effectï¼Ÿ React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚æ­£å¦‚ä¹‹å‰å­¦åˆ°çš„ï¼Œeffect åœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React ä¼šåœ¨æ‰§è¡Œå½“å‰ effect ä¹‹å‰å¯¹ä¸Šä¸€ä¸ª effect è¿›è¡Œæ¸…é™¤ã€‚æˆ‘ä»¬ç¨åå°†è®¨è®ºä¸ºä»€ä¹ˆè¿™å°†åŠ©äºé¿å… bugä»¥åŠå¦‚ä½•åœ¨é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶è·³è¿‡æ­¤è¡Œä¸ºã€‚
- æˆ‘ä»¬ä»‹ç»äº†ä¸€ä¸ªç”¨äºæ˜¾ç¤ºå¥½å‹æ˜¯å¦åœ¨çº¿çš„ FriendStatus ç»„ä»¶ã€‚ä» class ä¸­ props è¯»å– friend.idï¼Œç„¶ååœ¨ç»„ä»¶æŒ‚è½½åè®¢é˜…å¥½å‹çš„çŠ¶æ€ï¼Œå¹¶åœ¨å¸è½½ç»„ä»¶çš„æ—¶å€™å–æ¶ˆè®¢é˜…ï¼š
~~~js
  componentDidMount() {
    ChatAPI.subscribeToFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  }

  componentWillUnmount() {
    ChatAPI.unsubscribeFromFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  }
~~~
- **ä½†æ˜¯å½“ç»„ä»¶å·²ç»æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶ï¼Œfriend prop å‘ç”Ÿå˜åŒ–æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ** æˆ‘ä»¬çš„ç»„ä»¶å°†ç»§ç»­å±•ç¤ºåŸæ¥çš„å¥½å‹çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ª bugã€‚è€Œä¸”æˆ‘ä»¬è¿˜ä¼šå› ä¸ºå–æ¶ˆè®¢é˜…æ—¶ä½¿ç”¨é”™è¯¯çš„å¥½å‹ ID å¯¼è‡´å†…å­˜æ³„éœ²æˆ–å´©æºƒçš„é—®é¢˜ã€‚
- åœ¨ class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  componentDidUpdate æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š
~~~js
 componentDidMount() {
    ChatAPI.subscribeToFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  }

  componentDidUpdate(prevProps) {
    // å–æ¶ˆè®¢é˜…ä¹‹å‰çš„ friend.id
    ChatAPI.unsubscribeFromFriendStatus(
      prevProps.friend.id,
      this.handleStatusChange
    );
    // è®¢é˜…æ–°çš„ friend.id
    ChatAPI.subscribeToFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  }

  componentWillUnmount() {
    ChatAPI.unsubscribeFromFriendStatus(
      this.props.friend.id,
      this.handleStatusChange
    );
  }
~~~
- å¿˜è®°æ­£ç¡®åœ°å¤„ç† componentDidUpdate æ˜¯ React åº”ç”¨ä¸­å¸¸è§çš„ bug æ¥æºã€‚
- ä½¿ç”¨ Hook ä¸ä¼šå—åˆ°æ­¤ bug å½±å“, å› ä¸º useEffect é»˜è®¤å°±ä¼šå¤„ç†ã€‚å®ƒä¼šåœ¨è°ƒç”¨ä¸€ä¸ªæ–°çš„ effect ä¹‹å‰å¯¹å‰ä¸€ä¸ª effect è¿›è¡Œæ¸…ç†
## useMemo
- useMemoæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å€¼ç”¨äºäº§ç”Ÿä¿å­˜å€¼ã€‚ ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½œä¸ºdepä¾èµ–é¡¹ï¼Œæ•°ç»„é‡Œé¢çš„ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–ï¼Œé‡æ–°æ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œäº§ç”Ÿæ–°çš„å€¼ã€‚
- æŠŠâ€œåˆ›å»ºâ€å‡½æ•°å’Œä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ useMemoï¼Œå®ƒä»…ä¼šåœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰é‡æ–°è®¡ç®— memoized å€¼ã€‚è¿™ç§ä¼˜åŒ–æœ‰åŠ©äºé¿å…åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—ã€‚
- è®°ä½ï¼Œä¼ å…¥ useMemo çš„å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œã€‚**è¯·ä¸è¦åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œä¸æ¸²æŸ“æ— å…³çš„æ“ä½œï¼Œè¯¸å¦‚å‰¯ä½œç”¨è¿™ç±»çš„æ“ä½œå±äº useEffect çš„é€‚ç”¨èŒƒç•´**ï¼Œè€Œä¸æ˜¯ useMemoã€‚
- å¦‚æœæ²¡æœ‰æä¾›ä¾èµ–é¡¹æ•°ç»„ï¼ŒuseMemo åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè®¡ç®—æ–°çš„å€¼ã€‚
- ä½ å¯ä»¥æŠŠ useMemo ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µï¼Œä½†ä¸è¦æŠŠå®ƒå½“æˆè¯­ä¹‰ä¸Šçš„ä¿è¯ã€‚å°†æ¥ï¼ŒReact å¯èƒ½ä¼šé€‰æ‹©â€œé—å¿˜â€ä»¥å‰çš„ä¸€äº› memoized å€¼ï¼Œå¹¶åœ¨ä¸‹æ¬¡æ¸²æŸ“æ—¶é‡æ–°è®¡ç®—å®ƒä»¬ï¼Œæ¯”å¦‚ä¸ºç¦»å±ç»„ä»¶é‡Šæ”¾å†…å­˜ã€‚å…ˆç¼–å†™åœ¨æ²¡æœ‰ useMemo çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ‰§è¡Œçš„ä»£ç  â€”â€” ä¹‹åå†åœ¨ä½ çš„ä»£ç ä¸­æ·»åŠ  useMemoï¼Œä»¥è¾¾åˆ°ä¼˜åŒ–æ€§èƒ½çš„ç›®çš„ã€‚
### ç¼“å­˜ä¸€äº›å€¼ï¼Œé¿å…é‡æ–°æ‰§è¡Œä¸Šä¸‹æ–‡
~~~js
const number = useMemo(()=>{
    /** ....å¤§é‡çš„é€»è¾‘è¿ç®— **/
   return number
},[ props.number ]) // åªæœ‰ props.number æ”¹å˜çš„æ—¶å€™ï¼Œé‡æ–°è®¡ç®—numberçš„å€¼ã€‚
~~~
### å‡å°‘ä¸å¿…è¦çš„domå¾ªç¯
~~~js
/* ç”¨ useMemoåŒ…è£¹çš„listå¯ä»¥é™å®šå½“ä¸”ä»…å½“listæ”¹å˜çš„æ—¶å€™æ‰æ›´æ–°æ­¤listï¼Œè¿™æ ·å°±å¯ä»¥é¿å…selectListé‡æ–°å¾ªç¯ */
 {useMemo(() => (
      <div>{
          selectList.map((i, v) => (
              <span
                  className={style.listSpan}
                  key={v} >
                  {i.patentName} 
              </span>
          ))}
      </div>
), [selectList])}
~~~
### å‡å°‘å­ç»„ä»¶æ¸²æŸ“
~~~js
/* åªæœ‰å½“propsä¸­ï¼Œliståˆ—è¡¨æ”¹å˜çš„æ—¶å€™ï¼Œå­ç»„ä»¶æ‰æ¸²æŸ“ */
const  goodListChild = useMemo(()=> <GoodList list={ props.list } /> ,[ props.list ])
~~~
## useLayoutEffect æ¸²æŸ“æ›´æ–°ä¹‹å‰çš„ useEffect
- useEffect æ‰§è¡Œé¡ºåº ç»„ä»¶æ›´æ–°æŒ‚è½½å®Œæˆ -> æµè§ˆå™¨dom ç»˜åˆ¶å®Œæˆ -> æ‰§è¡ŒuseEffectå›è°ƒ ã€‚
- useLayoutEffect æ‰§è¡Œé¡ºåº ç»„ä»¶æ›´æ–°æŒ‚è½½å®Œæˆ ->  æ‰§è¡ŒuseLayoutEffectå›è°ƒ-> æµè§ˆå™¨dom ç»˜åˆ¶å®Œæˆ
- æ‰€ä»¥è¯´useLayoutEffect ä»£ç å¯èƒ½ä¼šé˜»å¡æµè§ˆå™¨çš„ç»˜åˆ¶  å¦‚æœæˆ‘ä»¬åœ¨useEffect é‡æ–°è¯·æ±‚æ•°æ®ï¼Œæ¸²æŸ“è§†å›¾è¿‡ç¨‹ä¸­ï¼Œè‚¯å®šä¼šé€ æˆç”»é¢é—ªåŠ¨çš„æ•ˆæœ,è€Œå¦‚æœç”¨useLayoutEffect ï¼Œå›è°ƒå‡½æ•°çš„ä»£ç å°±ä¼šé˜»å¡æµè§ˆå™¨ç»˜åˆ¶ï¼Œ- æ‰€ä»¥å¯å®šä¼šå¼•èµ·ç”»é¢å¡é¡¿ç­‰æ•ˆæœï¼Œé‚£ä¹ˆå…·ä½“è¦ç”¨ useLayoutEffect è¿˜æ˜¯ useEffect ï¼Œè¦çœ‹å®é™…é¡¹ç›®çš„æƒ…å†µï¼Œå¤§éƒ¨åˆ†çš„æƒ…å†µ useEffect éƒ½å¯ä»¥æ»¡è¶³çš„ã€‚
~~~js
const DemoUseLayoutEffect = () => {
    const target = useRef()
    useLayoutEffect(() => {
        /*æˆ‘ä»¬éœ€è¦åœ¨domç»˜åˆ¶ä¹‹å‰ï¼Œç§»åŠ¨domåˆ°åˆ¶å®šä½ç½®*/
        const { x ,y } = getPositon() /* è·å–è¦ç§»åŠ¨çš„ x,yåæ ‡ */
        animate(target.current,{ x,y })
    }, []);
    return (
        <div >
            <span ref={ target } className="animate"></span>
        </div>
    )
}
~~~
## useRef è·å–å…ƒç´  ,ç¼“å­˜æ•°æ®
- å’Œä¼ ç»Ÿçš„classç»„ä»¶refä¸€æ ·ï¼Œreact-hooks ä¹Ÿæä¾›è·å–å…ƒç´ æ–¹æ³• useRef,å®ƒæœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥ä½œä¸ºç¼“å­˜æ•°æ®çš„åˆå§‹å€¼ï¼Œè¿”å›å€¼å¯ä»¥è¢«domå…ƒç´ refæ ‡è®°ï¼Œå¯ä»¥è·å–è¢«æ ‡è®°çš„å…ƒç´ èŠ‚ç‚¹.
~~~js
const DemoUseRef = ()=>{
    const dom= useRef(null)
    const handerSubmit = ()=>{
        /*  <div >è¡¨å•ç»„ä»¶</div>  dom èŠ‚ç‚¹ */
        console.log(dom.current)
    }
    return <div>
        {/* ref æ ‡è®°å½“å‰domèŠ‚ç‚¹ */}
        <div ref={dom} >è¡¨å•ç»„ä»¶</div>
        <button onClick={()=>handerSubmit()} >æäº¤</button> 
    </div>
}
~~~
### é«˜é˜¶ç”¨æ³• ç¼“å­˜æ•°æ®
- å½“ç„¶useRefè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ä½œç”¨å°±æ˜¯ç¼“å­˜æ•°æ®ï¼Œæˆ‘ä»¬çŸ¥é“usestate ,useReducer æ˜¯å¯ä»¥ä¿å­˜å½“å‰çš„æ•°æ®æºçš„ï¼Œä½†æ˜¯å¦‚æœå®ƒä»¬æ›´æ–°æ•°æ®æºçš„å‡½æ•°æ‰§è¡Œå¿…å®šä¼šå¸¦æ¥æ•´ä¸ªç»„ä»¶ä»æ–°æ‰§è¡Œåˆ°æ¸²æŸ“ï¼Œå¦‚æœåœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨å£°æ˜å˜é‡ï¼Œåˆ™ä¸‹ä¸€æ¬¡æ›´æ–°ä¹Ÿä¼šé‡ç½®ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ‚„æ‚„çš„ä¿å­˜æ•°æ®ï¼Œè€Œåˆä¸æƒ³è§¦å‘å‡½æ•°çš„æ›´æ–°ï¼Œé‚£ä¹ˆuseRefæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„é€‰æ‹©ã€‚
- useRef å¯ä»¥ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ç”¨æ¥åˆå§‹åŒ–ä¿å­˜æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥åœ¨ current å±æ€§ä¸Šè·å–åˆ° ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å¯¹ current èµ‹å€¼æ–°çš„æ•°æ®æº
~~~js
// åˆå§‹åŒ–
const currenRef = useRef(InitialData)
// è·å–
const getCurrentData = currenRef.current
// æ›´æ”¹
currenRef.current = newData
~~~

~~~js
import React, { useState, useEffect, useMemo, useRef } from 'react'
export default function App() {
    const dom = useRef([1, 2])
    const [count, setCount] = useState(0)
    useEffect(() => {
        setTimeout(() => {
            // ä¿®æ”¹currentä¸ä¼šè§¦å‘å‡½æ•°æ›´æ–°ï¼Œä¼šåœ¨å…¶ä»–ä¼šé‡æ–°æ¸²æŸ“å‡½æ•°çš„hooksæ­ä¾¿è½¦ï¼Œå¦‚useStete
            dom.current =[4, 5]
        },2000)
    },[])
    return(
        <>
            <div>{[...dom.current]}</div>
            <div>{count}</div>
            <button onClick={() => setCount(count +1)} >ç‚¹å‡»</button>
        </>
        
    )
}
~~~

## useContext è‡ªç”±è·å–context
- æˆ‘ä»¬å¯ä»¥ä½¿ç”¨useContext ï¼Œæ¥è·å–çˆ¶çº§ç»„ä»¶ä¼ é€’è¿‡æ¥çš„contextå€¼ï¼Œè¿™ä¸ªå½“å‰å€¼å°±æ˜¯æœ€è¿‘çš„çˆ¶çº§ç»„ä»¶ Provider è®¾ç½®çš„valueå€¼ï¼Œ**useContextå‚æ•°ä¸€èˆ¬æ˜¯ç”± createContext æ–¹å¼å¼•å…¥** ,ä¹Ÿå¯ä»¥çˆ¶çº§ä¸Šä¸‹æ–‡contextä¼ é€’ ( å‚æ•°ä¸ºcontext )ã€‚useContext å¯ä»¥ä»£æ›¿ context.Consumer æ¥è·å–Providerä¸­ä¿å­˜çš„valueå€¼
~~~js
/* ç”¨useContextæ–¹å¼ */
const DemoContext = ()=> {
    const value:any = useContext(Context)
    /* my name is alien */
return <div> my name is { value.name }</div>
}

/* ç”¨Context.Consumer æ–¹å¼ */
const DemoContext1 = ()=>{
    return <Context.Consumer>
         {/*  my name is alien  */}
        { (value)=> <div> my name is { value.name }</div> }
    </Context.Consumer>
}

export default ()=>{
    return <div>
        <Context.Provider value={{ name:'alien' , age:18 }} >
            <DemoContext />
            <DemoContext1 />
        </Context.Provider>
    </div>
}
~~~
## useReducer æ— çŠ¶æ€ç»„ä»¶ä¸­çš„redux
- useReducer æ˜¯react-hooksæä¾›çš„èƒ½å¤Ÿåœ¨æ— çŠ¶æ€ç»„ä»¶ä¸­è¿è¡Œçš„ç±»ä¼¼reduxçš„åŠŸèƒ½apiï¼Œè‡³äºå®ƒåˆ°åº•èƒ½ä¸èƒ½ä»£æ›¿redux react-redux ,æˆ‘ä¸ªäººçš„çœ‹æ³•æ˜¯ä¸èƒ½çš„ ï¼Œredux èƒ½å¤Ÿå¤æ‚çš„é€»è¾‘ä¸­å±•ç°ä¼˜åŠ¿ ï¼Œè€Œä¸” reduxçš„ä¸­é—´ä»¶æ¨¡å¼æ€æƒ³ä¹Ÿæ˜¯éå¸¸ä¼˜ç§€äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸­é—´ä»¶çš„æ–¹å¼æ¥å¢å¼ºdispatch redux-thunk redux-sage redux-action redux-promiseéƒ½æ˜¯æ¯”è¾ƒä¸é”™çš„ä¸­é—´ä»¶ï¼Œå¯ä»¥æŠŠåŒæ­¥reducerç¼–ç¨‹å¼‚æ­¥çš„reducerã€‚useReducer æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªreducer ,reducerçš„å‚æ•°å°±æ˜¯å¸¸è§„reduceré‡Œé¢çš„stateå’Œaction,è¿”å›æ”¹å˜åçš„state, useReducerç¬¬äºŒä¸ªå‚æ•°ä¸ºstateçš„åˆå§‹å€¼ è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€é¡¹å°±æ˜¯æ›´æ–°ä¹‹åstateçš„å€¼ ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ´¾å‘æ›´æ–°çš„dispatchå‡½æ•° ã€‚**dispatch çš„è§¦å‘ä¼šè§¦å‘ç»„ä»¶çš„æ›´æ–°ï¼Œè¿™é‡Œèƒ½å¤Ÿä¿ƒä½¿ç»„ä»¶ä»æ–°çš„æ¸²æŸ“çš„ä¸€ä¸ªæ˜¯useStateæ´¾å‘æ›´æ–°å‡½æ•°ï¼Œå¦ä¸€ä¸ªå°± useReducerä¸­çš„dispatch**ã€‚

~~~JS
const DemoUseReducer = ()=>{
    /* numberä¸ºæ›´æ–°åçš„stateå€¼,  dispatchNumbner ä¸ºå½“å‰çš„æ´¾å‘å‡½æ•° */
   const [ number , dispatchNumbner ] = useReducer((state,action)=>{
       const { payload , name  } = action
       /* returnçš„å€¼ä¸ºæ–°çš„state */
       switch(name){
           case 'add':
               return state + 1
           case 'sub':
               return state - 1 
           case 'reset':
             return payload       
       }
       return state
   },0)
   return <div>
      å½“å‰å€¼ï¼š{ number }
      { /* æ´¾å‘æ›´æ–° */ }
      <button onClick={()=>dispatchNumbner({ name:'add' })} >å¢åŠ </button>
      <button onClick={()=>dispatchNumbner({ name:'sub' })} >å‡å°‘</button>
      <button onClick={()=>dispatchNumbner({ name:'reset' ,payload:666 })} >èµ‹å€¼</button>
      { /* æŠŠdispatch å’Œ state ä¼ é€’ç»™å­ç»„ä»¶  */ }
      <MyChildren  dispatch={ dispatchNumbner } State={{ number }} />
   </div>
}

~~~



## useCallback useMemoç‰ˆæœ¬çš„å›è°ƒå‡½æ•°
- useMemoå’ŒuseCallbackæ¥æ”¶çš„å‚æ•°éƒ½æ˜¯ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨å…¶ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–åæ‰æ‰§è¡Œï¼Œéƒ½æ˜¯è¿”å›ç¼“å­˜çš„å€¼ï¼ŒåŒºåˆ«åœ¨äºuseMemoè¿”å›çš„æ˜¯å‡½æ•°è¿è¡Œçš„ç»“æœï¼Œ**useCallbackè¿”å›çš„æ˜¯å‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æ˜¯ç»è¿‡å¤„ç†åçš„ä¹Ÿå°±æ˜¯è¯´çˆ¶ç»„ä»¶ä¼ é€’ä¸€ä¸ªå‡½æ•°ç»™å­ç»„ä»¶çš„æ—¶å€™ï¼Œç”±äºæ˜¯æ— çŠ¶æ€ç»„ä»¶æ¯ä¸€æ¬¡re-renderéƒ½ä¼šé‡æ–°ç”Ÿæˆæ–°çš„propså‡½æ•°ï¼Œè¿™æ ·å°±ä½¿å¾—æ¯ä¸€æ¬¡ä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•°éƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œ**è¿™æ—¶å€™å°±ä¼šè§¦å‘å­ç»„ä»¶çš„æ›´æ–°ï¼Œè¿™äº›æ›´æ–°æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡usecallbackæ¥å¤„ç†æ­¤å‡½æ•°ï¼Œç„¶åä½œä¸ºpropsä¼ é€’ç»™å­ç»„ä»¶
~~~js
/* ç”¨react.memo */
const DemoChildren = React.memo((props)=>{
   /* åªæœ‰åˆå§‹åŒ–çš„æ—¶å€™æ‰“å°äº† å­ç»„ä»¶æ›´æ–° */
    console.log('å­ç»„ä»¶æ›´æ–°')
   useEffect(()=>{
       props.getInfo('å­ç»„ä»¶')
   },[])
   return <div>å­ç»„ä»¶</div>
})

const DemoUseCallback=({ id })=>{
    const [number, setNumber] = useState(1)
    /* æ­¤æ—¶usecallbackçš„ç¬¬ä¸€å‚æ•° (sonName)=>{ console.log(sonName) }
     ç»è¿‡å¤„ç†èµ‹å€¼ç»™ getInfo */
    const getInfo  = useCallback((sonName)=>{
          console.log(sonName)
    },[id])
    return <div>
        {/* ç‚¹å‡»æŒ‰é’®è§¦å‘çˆ¶ç»„ä»¶æ›´æ–° ï¼Œä½†æ˜¯å­ç»„ä»¶æ²¡æœ‰æ›´æ–° */}
        <button onClick={ ()=>setNumber(number+1) } >å¢åŠ </button>
        <DemoChildren getInfo={getInfo} />
    </div>
}
~~~
- è¿™é‡Œåº”è¯¥æé†’çš„æ˜¯ï¼ŒuseCallback ï¼Œå¿…é¡»é…åˆ react.memo pureComponent ï¼Œå¦åˆ™ä¸ä½†ä¸ä¼šæå‡æ€§èƒ½ï¼Œè¿˜æœ‰å¯èƒ½é™ä½æ€§èƒ½
## useImperativeHandle
- useImperativeHandle å¯ä»¥é…åˆ forwardRef è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚è¿™ä¸ªå¾ˆæœ‰ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºå­ç»„ä»¶ï¼Œå¦‚æœæ˜¯classç±»ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡refè·å–ç±»ç»„ä»¶çš„å®ä¾‹ï¼Œä½†æ˜¯åœ¨å­ç»„ä»¶æ˜¯å‡½æ•°ç»„ä»¶çš„æƒ…å†µï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡refçš„ï¼Œé‚£ä¹ˆæ­¤æ—¶useImperativeHandleå’Œ forwardRefé…åˆå°±èƒ½è¾¾åˆ°æ•ˆæœ
- useImperativeHandleæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š
  ç¬¬ä¸€ä¸ªå‚æ•°ref: æ¥å— forWardRef ä¼ é€’è¿‡æ¥çš„ refã€‚
  ç¬¬äºŒä¸ªå‚æ•° createHandle ï¼šå¤„ç†å‡½æ•°ï¼Œè¿”å›å€¼ä½œä¸ºæš´éœ²ç»™çˆ¶ç»„ä»¶çš„refå¯¹è±¡ã€‚
  ç¬¬ä¸‰ä¸ªå‚æ•° deps:ä¾èµ–é¡¹ depsï¼Œä¾èµ–é¡¹æ›´æ”¹å½¢æˆæ–°çš„refå¯¹è±¡ã€‚
- `useImperativeHandle` å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ `ref` æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚`useImperativeHandle` åº”å½“ä¸ [`forwardRef`](https://zh-hans.reactjs.org/docs/react-api.html#reactforwardref) ä¸€èµ·ä½¿ç”¨ï¼š
~~~js
function FancyInput(props, ref) {
  const inputRef = useRef();
  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus();
    }
  }));
  return <input ref={inputRef} ... />;
}
FancyInput = forwardRef(FancyInput);
~~~
- åœ¨æœ¬ä¾‹ä¸­ï¼Œæ¸²æŸ“ `<FancyInput ref={inputRef} />` çš„çˆ¶ç»„ä»¶å¯ä»¥è°ƒç”¨ `inputRef.current.focus()`

## useDebugValue

- useDebugValue å¯ç”¨äºåœ¨ React å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ hook çš„æ ‡ç­¾ã€‚è¿™ä¸ªhooksç›®çš„å°±æ˜¯æ£€æŸ¥è‡ªå®šä¹‰hooks
~~~js
function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);
  // ...
  // åœ¨å¼€å‘è€…å·¥å…·ä¸­çš„è¿™ä¸ª Hook æ—è¾¹æ˜¾ç¤ºæ ‡ç­¾
  // e.g. "FriendStatus: Online"
  useDebugValue(isOnline ? 'Online' : 'Offline');

  return isOnline;
}
~~~
>
æˆ‘ä»¬ä¸æ¨èä½ å‘æ¯ä¸ªè‡ªå®šä¹‰ Hook æ·»åŠ  debug å€¼ã€‚å½“å®ƒä½œä¸ºå…±äº«åº“çš„ä¸€éƒ¨åˆ†æ—¶æ‰æœ€æœ‰ä»·å€¼ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ ¼å¼åŒ–å€¼çš„æ˜¾ç¤ºå¯èƒ½æ˜¯ä¸€é¡¹å¼€é”€å¾ˆå¤§çš„æ“ä½œã€‚é™¤ééœ€è¦æ£€æŸ¥ Hookï¼Œå¦åˆ™æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšã€‚å› æ­¤ï¼ŒuseDebugValue æ¥å—ä¸€ä¸ªæ ¼å¼åŒ–å‡½æ•°ä½œä¸ºå¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¯¥å‡½æ•°åªæœ‰åœ¨ Hook è¢«æ£€æŸ¥æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚å®ƒæ¥å— debug å€¼ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”ä¼šè¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ˜¾ç¤ºå€¼ã€‚
>
## useTransition
- useTransitionå…è®¸å»¶æ—¶ç”±stateæ”¹å˜è€Œå¸¦æ¥çš„è§†å›¾æ¸²æŸ“ã€‚é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚å®ƒè¿˜å…è®¸ç»„ä»¶å°†é€Ÿåº¦è¾ƒæ…¢çš„æ•°æ®è·å–æ›´æ–°æ¨è¿Ÿåˆ°éšåæ¸²æŸ“ï¼Œä»¥ä¾¿èƒ½å¤Ÿç«‹å³æ¸²æŸ“æ›´é‡è¦çš„æ›´æ–°ã€‚
~~~js
const TIMEOUT_MS = { timeoutMs: 2000 }
const [startTransition, isPending] = useTransition(TIMEOUT_MS)
~~~
- useTransition æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œ timeoutMsä»£ç éœ€è¦å»¶æ—¶çš„æ—¶é—´ã€‚
- è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ï¼š  æ˜¯ä¸€ä¸ªæ¥å—å›è°ƒçš„å‡½æ•°ã€‚æˆ‘ä»¬ç”¨å®ƒæ¥å‘Šè¯‰ React éœ€è¦æ¨è¿Ÿçš„ state ã€‚ ç¬¬äºŒä¸ªå‚æ•°ï¼š ä¸€ä¸ªå¸ƒå°”å€¼ã€‚è¡¨ç¤ºæ˜¯å¦æ­£åœ¨ç­‰å¾…ï¼Œè¿‡åº¦çŠ¶æ€çš„å®Œæˆ(å»¶æ—¶stateçš„æ›´æ–°)ã€‚
- ä¸‹é¢æˆ‘ä»¬å¼•å…¥å®˜ç½‘çš„åˆ—å­ï¼Œæ¥äº†è§£useTransitionçš„ä½¿ç”¨ã€‚
~~~js
const SUSPENSE_CONFIG = { timeoutMs: 2000 };

function App() {
  const [resource, setResource] = useState(initialResource);
  const [startTransition, isPending] = useTransition(SUSPENSE_CONFIG);
  return (
    <>
      <button
        disabled={isPending}
        onClick={() => {
          startTransition(() => {
            const nextUserId = getNextId(resource.userId);
            setResource(fetchProfileData(nextUserId));
          });
        }}
      >
        Next
      </button>
      {isPending ? " åŠ è½½ä¸­..." : null}
      <Suspense fallback={<Spinner />}>
        <ProfilePage resource={resource} />
      </Suspense>
    </>
  );
}

~~~
- åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ startTransition åŒ…è£…äº†æˆ‘ä»¬çš„æ•°æ®è·å–ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥ç«‹å³å¼€å§‹è·å–ç”¨æˆ·èµ„æ–™çš„æ•°æ®ï¼ŒåŒæ—¶æ¨è¿Ÿä¸‹ä¸€ä¸ªç”¨æˆ·èµ„æ–™é¡µé¢ä»¥åŠå…¶å…³è”çš„ Spinner çš„æ¸²æŸ“ 2 ç§’é’Ÿï¼ˆ timeoutMs ä¸­æ˜¾ç¤ºçš„æ—¶é—´ï¼‰
- è¿™ä¸ªapiç›®å‰å¤„äºå®éªŒé˜¶æ®µï¼Œæ²¡æœ‰è¢«å®Œå…¨å¼€æ”¾å‡ºæ¥ã€‚

## è‡ªå®šä¹‰kooks
### ä»€ä¹ˆè‡ªå®šä¹‰Hooks
- è‡ªå®šä¹‰hooksæ˜¯åœ¨react-hooksåŸºç¡€ä¸Šçš„ä¸€ä¸ªæ‹“å±•ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦åˆ¶å®šæ»¡è¶³ä¸šåŠ¡éœ€è¦çš„hooksï¼Œæ›´æ³¨é‡çš„æ˜¯é€»è¾‘å•å…ƒã€‚é€šè¿‡ä¸šåŠ¡åœºæ™¯ä¸åŒï¼Œæˆ‘ä»¬åˆ°åº•éœ€è¦react-hooksåšä»€ä¹ˆï¼Œæ€ä¹ˆæ ·æŠŠä¸€æ®µé€»è¾‘å°è£…èµ·æ¥ï¼Œåšåˆ°å¤ç”¨ï¼Œè¿™æ˜¯è‡ªå®šä¹‰hooksäº§ç”Ÿçš„åˆè¡·ã€‚
- hooks ä¸“æ³¨çš„å°±æ˜¯é€»è¾‘å¤ç”¨ï¼Œ æ˜¯æˆ‘ä»¬çš„é¡¹ç›®ï¼Œä¸ä»…ä»…åœç•™åœ¨ç»„ä»¶å¤ç”¨çš„å±‚é¢ä¸Šã€‚hooksè®©æˆ‘ä»¬å¯ä»¥å°†ä¸€æ®µé€šç”¨çš„é€»è¾‘å­˜å°èµ·æ¥ã€‚å°†æˆ‘ä»¬éœ€è¦å®ƒçš„æ—¶å€™ï¼Œå¼€ç®±å³ç”¨å³å¯ã€‚
### è‡ªå®šä¹‰hooks-é©±åŠ¨æ¡ä»¶
- hooksæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å‡½æ•°çš„æ‰§è¡Œï¼Œå†³å®šä¸æ— çŠ¶æ€ç»„ä»¶ç»„ä»¶è‡ªèº«çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚æ¯æ¬¡å‡½æ•°çš„æ‰§è¡Œ(æœ¬è´¨ä¸Šå°±æ˜¯ç»„ä»¶çš„æ›´æ–°)å°±ä¼šæ‰§è¡Œè‡ªå®šä¹‰hooksçš„æ‰§è¡Œï¼Œç”±æ­¤å¯è§ç»„ä»¶æœ¬èº«æ‰§è¡Œå’Œhooksçš„æ‰§è¡Œå¦‚å‡ºä¸€è¾™ã€‚
- é‚£ä¹ˆpropçš„ä¿®æ”¹,useState,useReducerä½¿ç”¨æ˜¯æ— çŠ¶æ€ç»„ä»¶æ›´æ–°æ¡ä»¶ï¼Œé‚£ä¹ˆå°±æ˜¯é©±åŠ¨hooksæ‰§è¡Œçš„æ¡ä»¶ã€‚ 
- é€šè¿‡è‡ªå®šä¹‰ Hookï¼Œå¯ä»¥å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚
- å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªç»„ä»¶ï¼Œä¸€ä¸ªæ˜¯å¥½å‹ä¿¡æ¯ç»„ä»¶ï¼Œæ ¹æ®å¥½å‹çš„çŠ¶æ€æ¥è®¾ç½®ç¦»çº¿ã€åœ¨çº¿ã€‚ä¸€ä¸ªæ˜¯å¥½å‹åˆ—è¡¨ç»„ä»¶ï¼Œæ ¹æ®å¥½å‹çŠ¶æ€æ¥è®¾ç½®å¤´åƒé¢œè‰²ã€‚æ‰€ä»¥è·å–å¥½å‹çŠ¶æ€çš„è¿™ä¸€ä¸ªé€»è¾‘å°±æ˜¯å¤ç”¨çš„ã€‚
~~~js
import { useState, useEffect } from 'react';

function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);

  useEffect(() => {
    function handleStatusChange(status) {
      setIsOnline(status.isOnline);
    }

    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);
    return () => {
      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);
    };
  });

  return isOnline;
}
~~~
- ä¸ React ç»„ä»¶ä¸åŒçš„æ˜¯ï¼Œè‡ªå®šä¹‰ Hook ä¸éœ€è¦å…·æœ‰ç‰¹æ®Šçš„æ ‡è¯†ã€‚æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„å†³å®šå®ƒçš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒåº”è¯¥è¿”å›ä»€ä¹ˆï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ªæ­£å¸¸çš„å‡½æ•°ã€‚ä½†æ˜¯å®ƒçš„åå­—åº”è¯¥å§‹ç»ˆä»¥ use å¼€å¤´ï¼Œ
- æ­¤å¤„ useFriendStatus çš„ Hook ç›®çš„æ˜¯è®¢é˜…æŸä¸ªå¥½å‹çš„åœ¨çº¿çŠ¶æ€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦å°† friendID ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›è¿™ä½å¥½å‹çš„åœ¨çº¿çŠ¶æ€çš„åŸå› ã€‚
### å¦‚ä½•ä½¿ç”¨
- æˆ‘ä»¬ä¸€å¼€å§‹çš„ç›®æ ‡æ˜¯åœ¨ FriendStatus å’Œ FriendListItem ç»„ä»¶ä¸­å»é™¤é‡å¤çš„é€»è¾‘ï¼Œå³ï¼šè¿™ä¸¤ä¸ªç»„ä»¶éƒ½æƒ³çŸ¥é“å¥½å‹æ˜¯å¦åœ¨çº¿ã€‚
- ç°åœ¨æˆ‘ä»¬å·²ç»æŠŠè¿™ä¸ªé€»è¾‘æå–åˆ° useFriendStatus çš„è‡ªå®šä¹‰ Hook ä¸­ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨å®ƒäº†ï¼š
~~~js
function FriendStatus(props) {
  const isOnline = useFriendStatus(props.friend.id);

  if (isOnline === null) {
    return 'Loading...';
  }
  return isOnline ? 'Online' : 'Offline';
}
~~~
~~~js
function FriendListItem(props) {
  const isOnline = useFriendStatus(props.friend.id);

  return (
    <li style={{ color: isOnline ? 'green' : 'black' }}>
      {props.friend.name}
    </li>
  );
}
~~~
- è¿™æ®µä»£ç ç­‰ä»·äºåŸæ¥çš„ç¤ºä¾‹ä»£ç å—ï¼Ÿç­‰ä»·ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ã€‚å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬æ²¡æœ‰å¯¹å…¶è¡Œä¸ºåšä»»ä½•çš„æ”¹å˜ï¼Œæˆ‘ä»¬åªæ˜¯å°†ä¸¤ä¸ªå‡½æ•°ä¹‹é—´ä¸€äº›å…±åŒçš„ä»£ç æå–åˆ°å•ç‹¬çš„å‡½æ•°ä¸­ã€‚è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§è‡ªç„¶éµå¾ª Hook è®¾è®¡çš„çº¦å®šï¼Œè€Œå¹¶ä¸æ˜¯ React çš„ç‰¹æ€§ã€‚
- è‡ªå®šä¹‰ Hook å¿…é¡»ä»¥ â€œuseâ€ å¼€å¤´å—ï¼Ÿå¿…é¡»å¦‚æ­¤ã€‚è¿™ä¸ªçº¦å®šéå¸¸é‡è¦ã€‚ä¸éµå¾ªçš„è¯ï¼Œç”±äºæ— æ³•åˆ¤æ–­æŸä¸ªå‡½æ•°æ˜¯å¦åŒ…å«å¯¹å…¶å†…éƒ¨ Hook çš„è°ƒç”¨ï¼ŒReact å°†æ— æ³•è‡ªåŠ¨æ£€æŸ¥ä½ çš„ Hook æ˜¯å¦è¿åäº† Hook çš„è§„åˆ™
- åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ Hook ä¼šå…±äº« state å—ï¼Ÿä¸ä¼šã€‚è‡ªå®šä¹‰ Hook æ˜¯ä¸€ç§é‡ç”¨çŠ¶æ€é€»è¾‘çš„æœºåˆ¶(ä¾‹å¦‚è®¾ç½®ä¸ºè®¢é˜…å¹¶å­˜å‚¨å½“å‰å€¼)ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ Hook æ—¶ï¼Œå…¶ä¸­çš„æ‰€æœ‰ state å’Œå‰¯ä½œç”¨éƒ½æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚
- è‡ªå®šä¹‰ Hook å¦‚ä½•è·å–ç‹¬ç«‹çš„ stateï¼Ÿæ¯æ¬¡è°ƒç”¨ Hookï¼Œå®ƒéƒ½ä¼šè·å–ç‹¬ç«‹çš„ stateã€‚ç”±äºæˆ‘ä»¬ç›´æ¥è°ƒç”¨äº† useFriendStatusï¼Œä» React çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬çš„ç»„ä»¶åªæ˜¯è°ƒç”¨äº† useState å’Œ useEffectã€‚ æ­£å¦‚æˆ‘ä»¬åœ¨ä¹‹å‰ç« èŠ‚ä¸­äº†è§£åˆ°çš„ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å¤šæ¬¡è°ƒç”¨ useState å’Œ useEffectï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚

